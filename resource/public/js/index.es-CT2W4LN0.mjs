var we=Object.defineProperty,Re=Object.defineProperties;var Pe=Object.getOwnPropertyDescriptors;var K=Object.getOwnPropertySymbols;var re=Object.prototype.hasOwnProperty,ae=Object.prototype.propertyIsEnumerable;var oe=Math.pow,te=(e,t,n)=>t in e?we(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,N=(e,t)=>{for(var n in t||(t={}))re.call(t,n)&&te(e,n,t[n]);if(K)for(var n of K(t))ae.call(t,n)&&te(e,n,t[n]);return e},ie=(e,t)=>Re(e,Pe(t));var U=(e,t)=>{var n={};for(var r in e)re.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(e!=null&&K)for(var r of K(e))t.indexOf(r)<0&&ae.call(e,r)&&(n[r]=e[r]);return n};var z=(e,t,n)=>new Promise((r,o)=>{var l=i=>{try{a(n.next(i))}catch(u){o(u)}},c=i=>{try{a(n.throw(i))}catch(u){o(u)}},a=i=>i.done?r(i.value):Promise.resolve(i.value).then(l,c);a((n=n.apply(e,t)).next())});import{R as le,J as C,a8 as G,P as y,ab as H,ac as k,S as q,U as Te}from"../jse/index-index-CmiOfTxA.mjs";const be={},ce=Symbol("GLOBAL_OPTIONS_PROVIDE_KEY"),fe=()=>be,_=e=>e,Ee=Object.prototype.toString,Se=e=>Ee.call(e),Ce=e=>Se(e)==="[object Object]",Q=e=>Array.isArray(e),D=e=>e!==null&&typeof e=="object",ee=e=>e instanceof Function,F=e=>e==null,ne=typeof window=="undefined",de=()=>{var e;return ne||F((e=window.document)===null||e===void 0?void 0:e.visibilityState)?!0:window.document.visibilityState==="visible"},ye=()=>{var e,t;return(e=!ne&&((t=window.navigator)===null||t===void 0?void 0:t.onLine))!==null&&e!==void 0?e:!0},Y=()=>new Promise(()=>{}),ue=function(e,t){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:void 0;const r=t.replace(/\[(\d+)\]/g,".$1").split(".");let o=e;for(const l of r)if(o=Object(o)[l],o===void 0)return n;return o},I=e=>Te(e)?e.value:e,Oe=e=>D(e)?Object.assign(Q(e)?[]:{},e):e,M=new Map,Ae=e=>F(e)?void 0:M.get(e),xe=(e,t,n)=>{const r=M.get(e);r!=null&&r.timer&&clearTimeout(r.timer);const o=setTimeout(()=>M.delete(e),t);M.set(e,ie(N({},n),{timer:o}))};function ve(e,t,n){let r,o,l,c,a,i,u=0,m=!1,f=!1,R=!0;const d=!t&&t!==0&&typeof window.requestAnimationFrame=="function";if(typeof e!="function")throw new TypeError("Expected a function");t=+t||0,D(n)&&(m=!!n.leading,f="maxWait"in n,l=f?Math.max(+n.maxWait||0,t):l,R="trailing"in n?!!n.trailing:R);function P(s){const S=r,A=o;return r=o=void 0,u=s,c=e.apply(A,S),c}function v(s,S){return d?(window.cancelAnimationFrame(a),window.requestAnimationFrame(s)):setTimeout(s,S)}function T(s){if(d)return window.cancelAnimationFrame(s);clearTimeout(s)}function g(s){return u=s,a=v(b,t),m?P(s):c}function w(s){const S=s-i,A=s-u,$=t-S;return f?Math.min($,l-A):$}function h(s){const S=s-i,A=s-u;return i===void 0||S>=t||S<0||f&&A>=l}function b(){const s=Date.now();if(h(s))return E(s);a=v(b,w(s))}function E(s){return a=void 0,R&&r?P(s):(r=o=void 0,c)}function O(){a!==void 0&&T(a),u=0,r=i=o=a=void 0}function x(){return a===void 0?c:E(Date.now())}function L(){return a!==void 0}function p(){const s=Date.now(),S=h(s);for(var A=arguments.length,$=new Array(A),j=0;j<A;j++)$[j]=arguments[j];if(r=$,o=this,i=s,S){if(a===void 0)return g(i);if(f)return a=v(b,t),P(i)}return a===void 0&&(a=v(b,t)),c}return p.cancel=O,p.flush=x,p.pending=L,p}function me(e,t){for(const n in t)if(t[n]!==void 0){if(!D(t[n])||!D(e[n])||!(n in e)){e[n]=t[n];continue}(Ce(t[n])||Q(t[n]))&&me(e[n],t[n])}}function se(e){const t=Object.assign({},e);for(var n=arguments.length,r=new Array(n>1?n-1:0),o=1;o<n;o++)r[o-1]=arguments[o];if(!r.length)return t;for(const l of r)me(t,l);return t}function Le(e,t,n){let r=!0,o=!0;if(typeof e!="function")throw new TypeError("Expected a function");return D(n)&&(r="leading"in n?!!n.leading:r,o="trailing"in n?!!n.trailing:o),ve(e,t,{leading:r,trailing:o,maxWait:t})}var Ie=_((e,t)=>{let{debounceInterval:n,debounceOptions:r,manual:o}=t;const l=y(!1),c=y(),a=C(()=>r),i=C(()=>I(n)),u=y(e.context.runAsync);return o||(l.value=!0),k(m=>{F(i.value)||(c.value=ve(f=>f(),i.value,a.value),e.context.runAsync=function(){for(var f=arguments.length,R=new Array(f),d=0;d<f;d++)R[d]=arguments[d];return new Promise((P,v)=>{l.value?(l.value=!1,u.value(...R).then(P).catch(v)):c.value(()=>{u.value(...R).then(P).catch(v)})})},m(()=>{var f;(f=c.value)===null||f===void 0||f.cancel(),e.context.runAsync=u.value}))}),{onCancel(){var m;(m=c.value)===null||m===void 0||m.cancel()}}}),$e=_((e,t)=>{let{errorRetryCount:n=0,errorRetryInterval:r=0}=t;const o=y(),l=y(0),c=C(()=>I(n)),a=C(()=>I(r));let i=!1;const u=()=>{l.value=0},m=C(()=>{if(a.value)return a.value;const d=1e3,T=Math.floor(Math.random()*oe(2,Math.min(l.value,9))+1);return d*T}),f=()=>{let d;const P=c.value===-1,v=l.value<c.value;return(P||v)&&(P||(l.value+=1),d=setTimeout(()=>{i=!0,e.context.refresh()},m.value)),()=>d&&clearTimeout(d)},R=()=>{o.value&&o.value()};return{onBefore(){i||u(),i=!1,R()},onSuccess(){u()},onError(){o.value=f()},onCancel(){u(),R()}}}),_e=_((e,t)=>{let{ready:n=y(!0),manual:r,defaultParams:o=[]}=t;return q(n,l=>{!r&&l&&e.context.run(...o)},{flush:"sync"}),{onBefore(){if(!(ee(n)?n():n.value))return e.loading.value=!1,{isBreak:!0}}}}),Ne=_((e,t)=>{let{refreshDeps:n,refreshDepsAction:r,manual:o}=t;if(n===void 0||Q(n)&&n.length===0)return{};const l=Q(n)?n:[n];return q(l,()=>{r?r():!o&&e.context.refresh()}),{}}),Be=_((e,t)=>{let{throttleInterval:n,throttleOptions:r}=t;const o=y(),l=C(()=>I(n)),c=C(()=>r),a=y(e.context.runAsync);return k(i=>{if(F(n))return{};o.value=Le(u=>u(),l.value,c.value),e.context.runAsync=function(){for(var u=arguments.length,m=new Array(u),f=0;f<u;f++)m[f]=arguments[f];return new Promise((R,d)=>{o.value(()=>{a.value(...m).then(R).catch(d)})})},i(()=>{var u;(u=o.value)===null||u===void 0||u.cancel(),e.context.runAsync=a.value})}),{onCancel(){var i;(i=o.value)===null||i===void 0||i.cancel()}}});const De=(e,t)=>n=>{Object.keys(n).forEach(r=>{e[r].value=n[r]}),t.forEach(r=>r(e))},Fe=(e,t)=>()=>{let n=t;for(let r=e.length;r-- >0;)n=e[r](n);return n()},je=(e,t,n)=>{var r,o;const{initialData:l,onSuccess:c,onError:a,onBefore:i,onAfter:u}=t,m=y((r=void 0)!==null&&r!==void 0?r:!1),f=H((o=void 0)!==null&&o!==void 0?o:l),R=H(void 0),d=y(void 0),P=y([]),v=H("pending"),T={},g=De({status:v,loading:m,data:f,error:R,params:d},[]),w=function(b){for(var E=arguments.length,O=new Array(E>1?E-1:0),x=1;x<E;x++)O[x-1]=arguments[x];if(b==="onQuery"){const L=P.value.map(p=>p.onQuery).filter(Boolean);return{servicePromise:Fe(L,O[0])()}}else{const L=P.value.map(p=>{var s;return(s=p[b])===null||s===void 0?void 0:s.call(p,...O)});return Object.assign({},...L)}},h=y(0);return T.runAsync=function(){return z(this,arguments,function*(){for(var b=arguments.length,E=new Array(b),O=0;O<b;O++)E[O]=arguments[O];g({loading:!0,params:E,status:"pending"}),h.value+=1;const x=h.value,{isBreak:L,breakResult:p=Y()}=w("onBefore",E);if(L)return g({status:"settled"}),p;i==null||i(E);try{const s=()=>new Promise($=>$(e(...d.value)));let{servicePromise:S}=w("onQuery",s);S||(S=s());const A=yield S;return x!==h.value?Y():(g({data:A,loading:!1,error:void 0,status:"settled"}),w("onSuccess",A,E),c==null||c(A,E),x===h.value&&w("onAfter",E,A,void 0),u==null||u(E),A)}catch(s){if(x!==h.value)return Y();throw g({loading:!1,error:s,status:"settled"}),w("onError",s,E),a==null||a(s,E),x===h.value&&w("onAfter",E,void 0,s),u==null||u(E),s}})},T.run=function(){T.runAsync(...arguments).catch(b=>{a||console.error(b)})},T.cancel=()=>{h.value+=1,g({loading:!1}),w("onCancel")},T.refresh=()=>{T.run(...d.value||[])},T.refreshAsync=()=>T.runAsync(...d.value||[]),T.mutate=b=>{const E=ee(b)?b(f.value):b,O=Oe(E);g({data:O}),w("onMutate",O)},{status:v,loading:m,data:f,error:R,params:d,plugins:P,context:T}};function Ke(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},n=arguments.length>2?arguments[2]:void 0;const r=le(ce,{}),o=N(N(N({},fe()),r),t),{manual:l=!1,defaultParams:c=[]}=o,a=je(e,o);if(a.plugins.value=n.map(i=>i(a,o)),!l){const i=a.params.value||c;a.context.run(...i)}return G(()=>{a.context.cancel()}),{loading:a.loading,data:a.data,error:a.error,params:a.params,cancel:a.context.cancel,refresh:a.context.refresh,refreshAsync:a.context.refreshAsync,mutate:a.context.mutate,run:a.context.run,runAsync:a.context.runAsync}}const W=new Map,Me=(e,t)=>{W.set(e,t),t.then(n=>(W.delete(e),n)).catch(()=>{W.delete(e)})},We=e=>W.get(e),B=new Map,Qe=(e,t)=>{B.has(e)&&B.get(e).forEach(n=>n(t))},Ve=(e,t)=>(B.has(e)?B.get(e).push(t):B.set(e,[t]),()=>{const n=B.get(e).indexOf(t);B.get(e).splice(n,1)});var Ge=_((e,t)=>{let{cacheKey:n,cacheTime:r=6e5,staleTime:o=0,getCache:l,setCache:c}=t;if(!n)return{};const a=ee(n)?n:()=>n,i=y(()=>{});let u;const m=g=>l?l(g):Ae(g),f=(g,w,h)=>{c?c(g,h):xe(g,w,h),Qe(g,h.data)},R=g=>o===-1||g+o>new Date().getTime(),d=(g,w)=>Object.prototype.hasOwnProperty.call(g,w),P=g=>{const w=a(g);return Ve(w,h=>{e.data.value=h})},v=a(),T=m(v);return T&&d(T,"data")&&(e.data.value=T.data,e.params.value=T.params),v&&(i.value=P()),G(()=>{i.value()}),{onBefore(g){const w=a(g),h=m(w);if(!h||!d(h,"data"))return{};if(R(h.time))return e.data.value=h.data,e.loading.value=!1,{isBreak:!0,breakResult:h.data};e.data.value=h.data},onQuery(g){const w=e.params.value,h=a(w);let b=We(h);return b&&b!==u?()=>b:(b=g(),u=b,Me(h,b),()=>b)},onSuccess(g,w){const h=a(w);h&&(i.value(),f(h,r,{data:g,params:w,time:new Date().getTime()}),i.value=P(w))},onMutate(g){const w=a(e.params.value);w&&(i.value(),f(w,r,{data:g,params:e.params.value,time:new Date().getTime()}),i.value=P(e.params.value))}}});function Ue(e){let t,n;class r extends Promise{constructor(l){super(l),this.cancel=()=>{n(),clearTimeout(t)}}}return new r(o=>{n=o,t=setTimeout(n,e)})}function J(){return new Date().getTime()}var ze=_((e,t)=>{let{loadingDelay:n=0,loadingKeep:r=0}=t;const o=y(()=>{}),l=C(()=>I(n)),c=C(()=>I(r));let a=0,i={};const u=()=>{let m;return l.value&&(m=setTimeout(()=>{e.status.value==="pending"&&(e.loading.value=!0)},l.value)),()=>m&&clearTimeout(m)};return{onBefore(){e.loading.value=!l.value,o.value(),o.value=u(),a=J()},onQuery(m){if(!c.value)return()=>m();i=Ue(c.value+l.value);const f=()=>z(this,null,function*(){try{const d=yield m();return J()-a<=l.value&&i.cancel(),Promise.resolve(d)}catch(d){return J()-a<=l.value&&i.cancel(),Promise.reject(d)}}),R=Promise.allSettled([f(),i]).then(d=>{const P=d[0];return P.status==="fulfilled"?P.value:Promise.reject(P.reason)});return()=>R},onCancel(){o.value()},onAfter(){o.value()}}}),X;const ge=new Set,he=new Set,pe=new Set,V=(e,t)=>{let n;switch(e){case"FOCUS_LISTENER":n=ge;break;case"RECONNECT_LISTENER":n=pe;break;case"VISIBLE_LISTENER":n=he;break}if(!n.has(t))return n.add(t),()=>{n.delete(t)}},Z=e=>{e.forEach(t=>{t()})};!ne&&(X=window)!==null&&X!==void 0&&X.addEventListener&&(window.addEventListener("visibilitychange",()=>{de()&&Z(he)},!1),window.addEventListener("focus",()=>Z(ge),!1),window.addEventListener("online",()=>Z(pe),!1));var He=_((e,t)=>{let{pollingInterval:n,pollingWhenHidden:r=!1,pollingWhenOffline:o=!1,errorRetryCount:l=0}=t;const c=y(),a=y(!1),i=C(()=>I(n)),u=C(()=>I(l)),m=[],f=v=>{v&&m.push(v)},R=()=>(r||de())&&(o||ye()),d=v=>{if(e.error.value&&u.value!==0)return;let T;if(!F(i.value)&&i.value>=0)if(R())T=setTimeout(v,i.value);else{a.value=!0;return}return()=>T&&clearTimeout(T)},P=()=>{a.value&&R()&&(e.context.refresh(),a.value=!1)};return q(i,()=>{c.value&&(c.value(),c.value=d(()=>e.context.refresh()))}),r||f(V("VISIBLE_LISTENER",P)),o||f(V("RECONNECT_LISTENER",P)),G(()=>{m.forEach(v=>v())}),{onBefore(){var v;(v=c.value)===null||v===void 0||v.call(c)},onCancel(){var v;(v=c.value)===null||v===void 0||v.call(c)},onAfter(){c.value=d(()=>e.context.refresh())}}});const Ye=(e,t)=>{let n=!1;return function(){n||(n=!0,e(...arguments),setTimeout(()=>{n=!1},t))}};var Je=_((e,t)=>{let{refreshOnWindowFocus:n=!1,refocusTimespan:r=5e3}=t;const o=C(()=>I(n)),l=C(()=>I(r)),c=[],a=u=>{u&&c.push(u)},i=()=>{c.forEach(u=>u())};return k(()=>{if(i(),o.value){const u=Ye(e.context.refresh,l.value);a(V("VISIBLE_LISTENER",u)),a(V("FOCUS_LISTENER",u))}}),G(()=>{i()}),{}});function Xe(e,t,n){return Ke(e,t,[ze,$e,Ie,He,Be,Je,Ne,_e,Ge])}function qe(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const n={currentKey:"current",pageSizeKey:"pageSize",totalKey:"total",totalPageKey:"totalPage"},r=le(ce,{}),x=t,{pagination:o}=x,l=U(x,["pagination"]),{currentKey:c,pageSizeKey:a,totalKey:i,totalPageKey:u}=se(n,fe().pagination||{},r.pagination||{},o||{}),m=se({defaultParams:[{[c]:1,[a]:10}]},l),L=Xe(e,m),{data:f,params:R,run:d}=L,P=U(L,["data","params","run"]),v=p=>{const[s,...S]=R.value||[],$=[N(N({},s),p),...S];d(...$)},T=p=>{v({[c]:p})},g=p=>{v({[a]:p})},w=(p,s)=>{v({[c]:p,[a]:s})},h=C(()=>ue(f.value,i,0)),b=C({get:()=>{var p,s,S;return(p=(s=R.value)===null||s===void 0||(S=s[0])===null||S===void 0?void 0:S[c])!==null&&p!==void 0?p:m.defaultParams[0][c]},set:p=>{T(p)}}),E=C({get:()=>{var p,s,S;return(p=(s=R.value)===null||s===void 0||(S=s[0])===null||S===void 0?void 0:S[a])!==null&&p!==void 0?p:m.defaultParams[0][a]},set:p=>{g(p)}}),O=C(()=>ue(f.value,u,Math.ceil(h.value/E.value)));return N({data:f,params:R,current:b,pageSize:E,total:h,totalPage:O,run:d,changeCurrent:T,changePageSize:g,changePagination:w},P)}export{Xe as a,qe as u};
