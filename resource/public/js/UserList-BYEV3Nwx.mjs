var f=(i,A,p)=>new Promise((c,_)=>{var I=d=>{try{O(p.next(d))}catch(l){_(l)}},N=d=>{try{O(p.throw(d))}catch(l){_(l)}},O=d=>d.done?c(d.value):Promise.resolve(d.value).then(I,N);O((p=p.apply(i,A)).next())});import{u as _e}from"./index.es-CT2W4LN0.mjs";import{g as ke}from"./ou-DVOk-Cf_.mjs";import{n as we}from"./util-oQdYwX59.mjs";import{g as he,s as Ue,d as be,r as Se}from"./user-7A8qe_c7.mjs";import{S as xe}from"./enum-BLvisX2J.mjs";import{_ as Pe}from"./UserForm.vue_vue_type_script_setup_true_lang-BKHwMSY4.mjs";import{S as Ne,E as Oe,e as Ce,M as De,n as Te}from"./bootstrap-5eopxyZm.mjs";import{R as j,M as Ie}from"./RollbackOutlined-C4ajMdEa.mjs";import{a6 as ze,P as r,a7 as Ee,J as B,aI as n,aF as E,aG as F,aH as o,n as t,aa as u,ao as y,h as g,aX as Fe,aW as Ae}from"../jse/index-index-CmiOfTxA.mjs";function Me(i){return f(this,null,function*(){return he(i)})}function Re(i){return f(this,null,function*(){return Ue(i)})}function $e(i){return f(this,null,function*(){return be(i)})}function Ke(i){return f(this,null,function*(){return Se(i)})}const Qe=ze({__name:"UserList",setup(i){const A={title:"displayName",key:"id",children:"children"},p=r([]),c=r([]),_=r([{displayName:"Expand to load",id:BigInt(0),children:[]}]),I=r(),N=r({});Ee(()=>ke("").then(a=>{console.log("treeData",a);const e=a.items;_.value=e,I.value=e[0],e.length>0&&e[0]!==void 0&&e[0].id!==void 0&&p.value.push(String(e[0].id))}).catch(a=>{console.log("err",a)}));const O=[{title:"Id",dataIndex:"id",key:"Id",sorter:!0,defaultSortOrder:"ascend"},{title:"User Name",dataIndex:"userName",key:"userName",name:"userName",sorter:!0,filtered:!0},{title:"Displayname",dataIndex:"displayName",key:"displayName",sorter:!0,filtered:!0},{title:"Email",dataIndex:"email",key:"email",sorter:!0,filtered:!0},{title:"Orgnization Unit",dataIndex:"ou",key:"ou",sorter:!0},{title:"Lock Out",dataIndex:"lockoutEnabled",key:"lockoutEnabled",sorter:!0},{title:"Temporary Password",dataIndex:"isTemporaryPassword",key:"isTemporaryPassword",sorter:!0},{title:"Actions",key:"action"}],d=r(),l=r({Account:"",Displayname:""}),k=r("id"),w=r("asc"),z=B(()=>{const a=[];return l.value.Account!==""&&a.push("account like ?"),l.value.Displayname!==""&&a.push("display_name like ?"),c.value.length>0&&c.value[0]!==void 0&&a.push("ou_id = ?"),a}),C=B(()=>{const a=[];return l.value.Account!==""&&a.push(`%${l.value.Account}%`),l.value.Displayname!==""&&a.push(`%${l.value.Displayname}%`),c.value.length>0&&c.value[0]!==void 0&&a.push(c.value[0]),a}),{data:L,run:D,refresh:q,loading:Q,total:Y,current:h,pageSize:U}=_e(Me,{defaultParams:[{page:1,pageSize:10,sortField:"id",sortOrder:xe.Asc,filters:z.value,args:C.value}],pagination:{currentKey:"page",pageSizeKey:"pageSize"}}),Z=new Map([["displayName","display_name"],["id","id"],["isTemporaryPassword","is_temporary_password"],["lockoutEnabled","lockout_enabled"]]),ee=B(()=>({total:Y.value,current:h.value,pageSize:U.value})),M=()=>{setTimeout(()=>{q()},50)},ae=(a,e)=>{N.value=e.node.dataRef,D({page:h.value,pageSize:U.value,sortField:k.value,sortOrder:w.value,filters:z.value,args:C.value}),console.log("selected node",a)},te=()=>{console.log("searchModel",l.value),setTimeout(()=>{D({page:h.value,pageSize:U.value,sortField:k.value,sortOrder:w.value,filters:z.value,args:C.value})},500)},oe=()=>{l.value={Account:"",Displayname:""},d.value.resetFields(),setTimeout(()=>{D({page:h.value,pageSize:U.value,sortField:k.value,sortOrder:w.value,filters:z.value,args:C.value})},500)},b=r(!1),T=r({id:"",displayName:""}),R=r(),le=a=>{T.value=a,b.value=!0},ne=a=>{$e(a),M()},V=r(!1),se=r(""),re=(a,e)=>f(this,null,function*(){Ke(a).then(m=>{De.warning({title:"Password only show once",content:g("div",{},[g("p",{},`user ${e} password is resetted to`),g(Te,{color:"red"},`${m.NewPwd}`)]),onOk(){M()}})})}),ie=()=>f(this,null,function*(){try{if(!(yield R.value.validate()))return}catch(a){console.log("error submit:",a);return}console.log("row",T.value),Re(T.value),b.value=!1,M()}),de=()=>{R.value.resetForm(),b.value=!1},ue=()=>f(this,null,function*(){const a=yield we();T.value={id:a.id,ou:N.value.name,ouId:N.value.id},b.value=!0}),ce=(a,e,m)=>{if(h.value=a.current,U.value=a.pageSize,m.field){const S=Z.get(m.field);k.value=S!=null?S:m.field,w.value=m.order}else k.value="Id",w.value="asc";console.log("filters",e),D({page:h.value,pageSize:U.value,sortField:k.value,sortOrder:w.value,filters:e.value,args:C.value})};return(a,e)=>{const m=n("a-tree"),S=n("a-col"),pe=n("a-page-header"),G=n("a-input"),$=n("a-form-item"),x=n("a-button"),H=n("a-divider"),me=n("a-form"),K=n("a-tooltip"),J=n("a-popconfirm"),ve=n("a-space"),W=n("a-switch"),fe=n("a-table"),X=n("a-modal"),ye=n("a-tag"),ge=n("a-row");return E(),F(ge,{gutter:16,style:{"margin-bottom":"5px"}},{default:o(()=>[t(S,{span:4},{default:o(()=>[t(m,{ref_key:"orgTree",ref:I,"expanded-keys":p.value,"onUpdate:expandedKeys":e[0]||(e[0]=s=>p.value=s),"selected-keys":c.value,"onUpdate:selectedKeys":e[1]||(e[1]=s=>c.value=s),"field-names":A,"tree-data":_.value,style:{height:"400px","margin-bottom":"5px"},onSelect:ae},null,8,["expanded-keys","selected-keys","tree-data"])]),_:1}),t(S,{span:16},{default:o(()=>[t(pe,{style:{border:"1px solid rgb(235 237 240)"},"sub-title":"User list page",title:"Users"}),t(me,{ref_key:"searchForm",ref:d,model:l.value,layout:"inline"},{default:o(()=>[t($,{label:"Account"},{default:o(()=>[t(G,{value:l.value.Account,"onUpdate:value":e[2]||(e[2]=s=>l.value.Account=s),placeholder:"Account"},null,8,["value"])]),_:1}),t($,{label:"Displayname"},{default:o(()=>[t(G,{value:l.value.Displayname,"onUpdate:value":e[3]||(e[3]=s=>l.value.Displayname=s),placeholder:"Displayname"},null,8,["value"])]),_:1}),t($,null,{default:o(()=>[t(x,{type:"primary",onClick:te},{icon:o(()=>[t(u(Ne))]),default:o(()=>[e[6]||(e[6]=y(" Search "))]),_:1}),t(x,{icon:g(u(j)),type:"primary",onClick:oe},{default:o(()=>e[7]||(e[7]=[y(" Reset ")])),_:1},8,["icon"]),t(H,{type:"vertical"}),t(x,{icon:g(u(Ie)),type:"primary",onClick:ue},{default:o(()=>e[8]||(e[8]=[y(" New ")])),_:1},8,["icon"])]),_:1})]),_:1},8,["model"]),t(H,{type:"horizontal"}),t(fe,{columns:O,"data-source":u(L)?u(L).list:null,loading:u(Q),pagination:ee.value,run:u(D),onChange:ce},{bodyCell:o(({column:s,record:v})=>[s.key==="action"?(E(),F(ve,{key:0},{default:o(()=>[t(K,null,{title:o(()=>e[9]||(e[9]=[y(" Edit")])),default:o(()=>[t(x,{icon:g(u(Oe)),type:"primary",onClick:P=>le(v)},null,8,["icon","onClick"])]),_:2},1024),t(K,null,{title:o(()=>e[10]||(e[10]=[y("Delete")])),default:o(()=>[t(J,{placement:"right",title:"Delete User",onConfirm:P=>ne(v.id)},{default:o(()=>[t(x,{icon:g(u(Ce)),danger:""},null,8,["icon"])]),_:2},1032,["onConfirm"])]),_:2},1024),t(K,null,{title:o(()=>e[11]||(e[11]=[y("Reset Password")])),default:o(()=>[t(J,{placement:"right",title:"Reset Password",onConfirm:P=>re(v.id,v.account)},{default:o(()=>[t(x,{icon:g(u(j)),danger:""},null,8,["icon"])]),_:2},1032,["onConfirm"])]),_:2},1024)]),_:2},1024)):s.key==="lockoutEnabled"?(E(),F(W,{key:1,checked:v.lockoutEnabled,"onUpdate:checked":P=>v.lockoutEnabled=P,size:"small"},null,8,["checked","onUpdate:checked"])):s.key==="isTemporaryPassword"?(E(),F(W,{key:2,checked:v.isTemporaryPassword,"onUpdate:checked":P=>v.isTemporaryPassword=P,size:"small"},null,8,["checked","onUpdate:checked"])):Fe("",!0)]),_:1},8,["data-source","loading","pagination","run"]),t(X,{open:b.value,"onUpdate:open":e[4]||(e[4]=s=>b.value=s),title:"Edit User Info",onCancel:de,onOk:ie},{default:o(()=>[t(Pe,{ref_key:"modalForm",ref:R,"form-model":T.value,"org-tree-data":_.value},null,8,["form-model","org-tree-data"])]),_:1},8,["open"]),t(X,{open:V.value,"onUpdate:open":e[5]||(e[5]=s=>V.value=s),title:"New Password"},{default:o(()=>[e[12]||(e[12]=y(" User password is resetted to: ")),t(ye,{color:"red"},{default:o(()=>[y(Ae(se.value),1)]),_:1})]),_:1},8,["open"])]),_:1})]),_:1})}}});export{Qe as default};
