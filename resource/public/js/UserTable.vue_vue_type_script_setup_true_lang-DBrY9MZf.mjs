var se=Object.defineProperty,le=Object.defineProperties;var re=Object.getOwnPropertyDescriptors;var D=Object.getOwnPropertySymbols;var ie=Object.prototype.hasOwnProperty,ue=Object.prototype.propertyIsEnumerable;var F=(a,e,t)=>e in a?se(a,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):a[e]=t,O=(a,e)=>{for(var t in e||(e={}))ie.call(e,t)&&F(a,t,e[t]);if(D)for(var t of D(e))ue.call(e,t)&&F(a,t,e[t]);return a},P=(a,e)=>le(a,re(e));var m=(a,e,t)=>new Promise((r,v)=>{var k=i=>{try{f(t.next(i))}catch(g){v(g)}},M=i=>{try{f(t.throw(i))}catch(g){v(g)}},f=i=>i.done?r(i.value):Promise.resolve(i.value).then(k,M);f((t=t.apply(a,e)).next())});import{u as ce}from"./index.es-CT2W4LN0.mjs";import{r as b,j as de,e as pe}from"./bootstrap-5eopxyZm.mjs";import{g as me}from"./user-7A8qe_c7.mjs";import{a6 as ve,P as _,J as N,T as fe,S as ge,aI as l,aF as A,aG as I,aH as u,n as c,aa as y,b3 as _e,ao as $,h as ye,aX as be}from"../jse/index-index-CmiOfTxA.mjs";const h={Members:"/api/v1/system/group/{0}/members",Get:"/api/v1/system/group/",PUT:"/api/v1/system/group",Delete:"/api/v1/system/group/",Page:"/api/v1/system/group/list"};function Te(a){return m(this,null,function*(){return b.post(h.Page,a)})}function xe(a){return m(this,null,function*(){return b.delete(h.Delete+a)})}function De(a){return m(this,null,function*(){return b.put(h.PUT,a)})}function he(a,e){return m(this,null,function*(){const t=h.Members.replace("{0}",e),r=P(O({},a),{Id:e});return b.post(t,r)})}function ke(a,e){return m(this,null,function*(){const t=h.Members.replace("{0}",a);return b.put(t,{userIds:e})})}function Ce(a,e){return m(this,null,function*(){const t=h.Members.replace("{0}",a);return b.delete(t,{params:{userIds:e}})})}const Fe=ve({__name:"UserTable",props:{id:{}},setup(a){const e=a,t=[{title:"User Name",dataIndex:"userName",key:"userName",name:"userName"},{title:"Email",dataIndex:"email",key:"email",sorter:!0,filtered:!0},{title:"Orgnization Unit",dataIndex:"ou",key:"ou",sorter:!0},{title:"Actions",key:"action"}],r=_({Account:"",Displayname:""}),v=_("id"),k=_("asc"),M=N(()=>{const o=[];return r.value.Account!==""&&o.push("user_name like ?"),r.value.Displayname!==""&&o.push("display_name like ?"),o}),f=N(()=>{const o=[];return r.value.Account!==""&&o.push(`%${r.value.Account}%`),r.value.Displayname!==""&&o.push(`%${r.value.Displayname}%`),o}),{data:i,run:g,refresh:E,loading:R,total:L,current:w,pageSize:z}=ce(he,{defaultParams:[{page:1,pageSize:10,sortField:"id",sortOrder:"asc",filters:M.value,args:f.value},e.id],pagination:{currentKey:"page",pageSizeKey:"pageSize"}}),V=new Map([["displayName","display_name"],["id","id"],["isTemporaryPassword","is_temporary_password"],["lockoutEnabled","lockout_enabled"]]),B=N(()=>({total:L.value,current:w.value,pageSize:z.value})),U=()=>{setTimeout(()=>{E()},50)},S=_(!1),G=_({id:"",displayName:""}),T=_(),K=o=>{Ce(e.id,o),U()},j=()=>m(this,null,function*(){try{if(!(yield T.value.validate()))return}catch(o){console.log("error submit:",o);return}console.log("row",G.value),S.value=!1,U()}),q=()=>{T.value.resetForm(),S.value=!1},H=(o,s,d)=>{if(w.value=o.current,z.value=o.pageSize,d.field){const p=V.get(d.field);v.value=p!=null?p:d.field,k.value=d.order}else v.value="Id",k.value="asc";console.log("filters",s),g({page:w.value,pageSize:z.value,sortField:v.value,sortOrder:k.value,filters:s.value,args:f.value},e.id)},n=fe({data:[],value:[],fetching:!1}),J=de(o=>{console.log("fetching user",o),n.data=[],n.fetching=!0,me({page:1,pageSize:10,sortField:"user_name",sortOrder:"asc",filters:["user_name like ?"],args:[`%${o}%`]}).then(s=>{const d=s.list.map(p=>({label:`${p.displayName}`,value:p.id}));n.data=d,n.fetching=!1,console.log("state",n)})},300),X=()=>{console.log("state.value",n.value);const o=[];n.value.forEach(s=>{o.push(s.value)}),console.log("ids",o),ke(e.id,o).then(()=>{U(),n.data=[],n.value=[]})};return ge(n.value,()=>{n.data=[],n.fetching=!1}),(o,s)=>{const d=l("a-spin"),p=l("a-select"),x=l("a-button"),Q=l("a-divider"),W=l("a-popconfirm"),Y=l("a-tooltip"),Z=l("a-space"),ee=l("a-table"),ae=l("a-modal"),te=l("a-col"),oe=l("a-row");return A(),I(oe,{gutter:16,style:{"margin-bottom":"5px"}},{default:u(()=>[c(te,{span:16},{default:u(()=>[c(p,{value:n.value,"onUpdate:value":s[0]||(s[0]=C=>n.value=C),"filter-option":!1,"not-found-content":n.fetching?void 0:null,options:n.data,"label-in-value":"",mode:"multiple",placeholder:"Select users",style:{width:"100%"},onSearch:y(J)},_e({_:2},[n.fetching?{name:"notFoundContent",fn:u(()=>[c(d,{size:"small"})]),key:"0"}:void 0]),1032,["value","not-found-content","options","onSearch"]),c(x,{type:"primary",onClick:X},{icon:u(()=>s[2]||(s[2]=[])),default:u(()=>[s[3]||(s[3]=$(" Add Member "))]),_:1}),c(Q,{type:"horizontal"}),c(ee,{columns:t,"data-source":y(i)?y(i).list:null,loading:y(R),pagination:B.value,run:y(g),onChange:H},{bodyCell:u(({column:C,record:ne})=>[C.key==="action"?(A(),I(Z,{key:0},{default:u(()=>[c(Y,null,{title:u(()=>s[4]||(s[4]=[$("Delete")])),default:u(()=>[c(W,{placement:"right",title:"Remove Role Member",onConfirm:Se=>K(ne.id)},{default:u(()=>[c(x,{icon:ye(y(pe)),danger:""},null,8,["icon"])]),_:2},1032,["onConfirm"])]),_:2},1024)]),_:2},1024)):be("",!0)]),_:1},8,["data-source","loading","pagination","run"]),c(ae,{open:S.value,"onUpdate:open":s[1]||(s[1]=C=>S.value=C),title:"Edit User Info",onCancel:q,onOk:j},null,8,["open"])]),_:1})]),_:1})}}});export{Fe as _,xe as d,Te as g,De as s};
